<!DOCTYPE html><html lang="en" data-astro-cid-sckkx6r4> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v5.16.3"><title>Astro Basics</title><style>html,body{margin:0;width:100%;height:100%}
</style></head> <body data-astro-cid-sckkx6r4>  <div id="container"> <img id="background" alt=""> <main> <section id="hero"> <img alt="Astro logo" width="64" height="64"> <h1>Register for Virtual Venus</h1> <p>Sign up with your university details to get access.</p> <form id="registerForm" class="box" method="post" action="#" aria-label="University registration form"> <label for="name">Full name</label> <input id="name" name="name" type="text" placeholder="Jane Doe" required> <label for="email">University email</label> <input id="email" name="email" type="email" placeholder="name@university.edu" required pattern=".+@.+..+"> <label for="course">Course</label> <input id="course" name="course" type="text" placeholder="BSc Computer Science" required> <label for="gradYear">Graduation year</label> <input id="gradYear" name="gradYear" type="number" min="2023" max="2100" step="1" placeholder="2026" required> <div id="links"> <button id="submitBtn" type="submit" class="button" aria-label="Register">Register</button> </div> <div id="status" role="status" aria-live="polite" style="margin-top:12px;"></div> </form> </section> </main> <script type="module">
	// Redirect to dashboard on client if registrationId cookie is present
	if (typeof document !== 'undefined' && document.cookie.split('; ').some(c => c.trim().startsWith('registrationId='))) {
		window.location.href = '/dashboard';
	}

	const form = document.getElementById('registerForm');
	const statusEl = document.getElementById('status');
	const submitBtn = document.getElementById('submitBtn');

	form.addEventListener('submit', async (e) => {
		e.preventDefault();
		statusEl.textContent = '';
		submitBtn.disabled = true;

		const fd = new FormData(form);
		const payload = {
			name: fd.get('name')?.toString() || '',
			email: fd.get('email')?.toString() || '',
			course: fd.get('course')?.toString() || '',
			gradYear: fd.get('gradYear')?.toString() || '',
		};

		try {
			const res = await fetch('/api/register', {
				method: 'POST',
				headers: { 'Content-Type': 'application/json' },
				body: JSON.stringify(payload),
			});

			if (res.ok) {

			
				// parse response and store auto id in localStorage if present
				const data = await res.json().catch(() => null);	console.log(data.data.id);
				const id = String(data.data?.id ?? data.id ?? data.ID ?? data._id);
						console.log('Storing registration ID in cookie:', id);
						const maxAge = 60 * 60 * 24 * 30; // 30 days
						document.cookie = `registrationId=${encodeURIComponent(id)}; path=/; max-age=${maxAge}; SameSite=Lax; Secure`;
				const email = String(data.data?.email ?? data.id ?? data.ID ?? data._id);
						console.log('Storing registration ID in cookie:', id);
					
						document.cookie = `email=${encodeURIComponent(email)}; path=/; max-age=${maxAge}; SameSite=Lax; Secure`;
			
				
			}

			if (!res.ok) {
				const err = await res.json().catch(() => ({ message: res.statusText }));
				statusEl.textContent = 'Registration failed: ' + (err.message || res.statusText);
				statusEl.style.color = 'crimson';
			} else {
				statusEl.textContent = 'Registration successful. Check your email for next steps.';
				statusEl.style.color = 'green';
				window.location.href = '/dashboard';
				form.reset();
			}
		} catch (error) {
			statusEl.textContent = 'Network error. Please try again.';
			statusEl.style.color = 'crimson';
		} finally {
			submitBtn.disabled = false;
		}
	});
</script> </div>  </body></html>